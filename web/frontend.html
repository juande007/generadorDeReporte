<!DOCTYPE html>
<html lang="es">
    <head>
      <title>Generador de Reportes</title>
        <link rel="stylesheet" href="css/main.css">
        <script type='text/javascript' src='/eel.js'></script>
        <script type='text/javascript'>

        async function pick_file() {
            let comando = document.getElementById('input_box').value;
            let file_div = document.getElementById('file-name');

          // Call into Python so we can access the file system
            let random_filename = await eel.pick_file(comando)();
            file_div.innerHTML = random_filename;
          }
        async function clientes() {
            let div_clientes = document.getElementById('div_clientes');
            let clientes = await eel.clientes()();

            div_clientes.innerHTML = clientes;
          // console.log("async function cliente "+clientes);
            return "hola";
          }

        async function listaIncidentes(){
            let div_incidents = document.getElementById('div_incidents');
            let listaIncidentes = await eel.listaIncidentes()();

            div_incidents.innerHTML = listaIncidentes;
            console.log("Entro al script incidentes")
            return "test";
          }
        var c = '';
        async function imprimirSonda(){

        $('.democlass').each(function() {
        var a=$(this).attr('id');
        var b=$(this).attr('value');
        a = a.concat(","+b+";");
        c=c.concat(a);
        });

        console.log("Resultado = "+c)
        var cliente = document.getElementById("cliente").value;
        console.log("El cliente es "+cliente)

        let datosSonda = await eel.imprimirSonda(c, cliente)();

        var textodeldiv = document.getElementById("divReporte").innerHTML;
        document.getElementById("divReporte").innerHTML = "<div>"+cliente+"</div>";

        }
        function buscarCliente (algo){
            document.getElementById('input_box').value = algo
        }
        function adicionarSondaAReporte(sonda,issue){
          var addSonda=document.createElement("input");
          addSonda.type="radio";
          addSonda.value=issue;
          addSonda.id=sonda;
          addSonda.checked =true;
          addSonda.name = sonda;
          var textnode = document.createTextNode(sonda+":"+issue);
          var att = document.createAttribute("class");
          att.value = "democlass";
          // var types = document.create("type");
          // att.value = "radio";
          addSonda.appendChild(textnode);
          //addSonda.appendChild(att);
          addSonda.setAttributeNode(att);
          document.getElementById("divReporte").appendChild(addSonda);

          var labelSonda = document.createElement("label");
          var textSonda = document.createTextNode(sonda+":"+issue);
          labelSonda.appendChild(textSonda);
          document.getElementById("divReporte").appendChild(labelSonda);
          //addsonda.setAttribute("class", "democlass");
          console.log("Entró a la funcion"+xy)
          }
        function  adicionarIssueAReporte (xyz)
          {
            document.getElementById('div_incidents').appendChild = xyz
            console.log("Hola issue")
            document.getElementById("divReporte").textContent = xyz;
            }
        function showAlert() {
          alert ("¡Se creo el documento con éxito!");
          location.reload();
            }
    </script>

      </script>
  </head>
  <body onload="clientes();listaIncidentes();">
    <header align = "center">
      <h1>Generador de Reportes</h1>
    </header>
      <aside>
        <div>
        <form onsubmit="pick_file(); return false;" >
          <input id='input_box' class = "lineasComando">
          <button class = "rainbow-button" type="submit">Buscar</button>
        </form>
      </div>
      <div class = "vista_general">
        <div class = "lista">
            <h3 id="div_clientes"></h3>
        </div>
        <div class = "lista">
            <h3 id='file-name'></h3>
        </div>
        <div class = "lista">
          <h3 id="div_incidents"></h3>
        </div>
        <div class = "lista" id="divReporte">
          <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
          <h3 id="adicionarSondaAReporte"></h3>
          <form onsubmit="imprimirSonda(); return false;" >
          <div id="clientesMostrar">cliente</div>
          <button class = "rainbow-button" type="submit" onclick = "showAlert()">Enviar</button>
          </form>
        </div>
      </div>
    </aside>
  </body>
</html>
